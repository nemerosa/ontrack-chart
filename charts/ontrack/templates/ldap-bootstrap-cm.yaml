{{- if and .Values.auth.keycloak.enabled .Values.auth.keycloak.ldap.enabled .Values.auth.keycloak.ldap.testing.enabled .Values.auth.keycloak.ldap.testing.provisioning.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "ontrack.fullname" . }}-ldap-bootstrap
data:
  admin.ldif: |-
    dn: ou=users,dc={{ .Values.auth.keycloak.ldap.testing.provisioning.domain.name }},dc={{.Values.auth.keycloak.ldap.testing.provisioning.domain.extension }}
    changetype: add
    objectClass: top
    objectClass: organizationalUnit
    ou: users

    dn: uid=admin,ou=users,dc={{ .Values.auth.keycloak.ldap.testing.provisioning.domain.name }},dc={{.Values.auth.keycloak.ldap.testing.provisioning.domain.extension }}
    changetype: add
    objectClass: inetOrgPerson
    objectClass: organizationalPerson
    objectClass: person
    objectClass: top
    uid: admin
    cn: Administrator
    sn: Administrator
    mail: {{ .Values.auth.admin.email }}
    userPassword: {{ .Values.auth.keycloak.ldap.testing.provisioning.admin.sshaPassword }}

{{- end }}
